<script src="//maps.google.com/maps/api/js?key=AIzaSyBqAlo6eTQeSbkOn3xYIjJ4e1zr4ewrSxU"></script>
<%= javascript_include_tag "locationpicker.jquery"  %>
<input type="text" id="latitude" name="shoot_location[latitude]" style="display:none" />
<input type="text" id="longitude" name="shoot_location[longitude]" style="display:none"  />
<input type="text" id="input" name="shoot_location[input]" style="display:none"  />

<div id="work_map" value=" " style="width: 100%; height: 400px;"></div>
<label for="shoot_location[detail]"> detail</label>
<% if object.address.present? %>
<input type="text" id="detail" name="shoot_location[detail]" value="<%= object.address.detail %>"/>
<% else %>
<input type="text" id="detail" name="shoot_location[detail]"/>
<% end %>
<script type="text/javascript">
  $(document).ready(function () {

    var mapStyle = [
    {
      "featureType": "water",
      "stylers": [
      {
        "saturation": 43
      },
      {
        "lightness": -11
      },
      {
        "hue": "#0088ff"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "hue": "#ff0000"
      },
      {
        "saturation": -100
      },
      {
        "lightness": 99
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry.stroke",
      "stylers": [
      {
        "color": "#808080"
      },
      {
        "lightness": 54
      }
      ]
    },
    {
      "featureType": "landscape.man_made",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "color": "#ece2d9"
      }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "color": "#ccdca1"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.fill",
      "stylers": [
      {
        "color": "#767676"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.stroke",
      "stylers": [
      {
        "color": "#ffffff"
      }
      ]
    },
    {
      "featureType": "poi",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    },
    {
      "featureType": "landscape.natural",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "visibility": "on"
      },
      {
        "color": "#EBE5E0"
      }
      ]
    },
    {
      "featureType": "poi.park",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    },
    {
      "featureType": "poi.sports_complex",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    }
    ]


    <% if object.address.present? %>
    var latitude = <%= object.address.lattitude %>;
    var longitude = <%= object.address.longtitude %>;
    <% else %>
    var latitude = 35.7745054;
    var longitude = 51.3967018;
    <% end %>

    $('#work_map').locationpicker({
      location: {
        latitude: latitude,
        longitude: longitude
      },
      radius: 10,
      zoom: 13,
      inputBinding: {
        longitudeInput: $('#longitude'),
        latitudeInput: $('#latitude'),
        locationNameInput: $('#input')
      },
      // markerInCenter: true,
      enableAutocomplete: true,
      autocompleteOptions: {
        types: ['geocode'],
        componentRestrictions: {country: 'ir'}
      },
      onchanged: function (currentLocation, radius, isMarkerDropped) {
        // alert("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");
      },
      styles: mapStyle
    });
  });


  function getLocation_home()
  {
    document.getElementById("myButton1").value="در حال تشخیص ...";
    var x = document.getElementById("geolocation_status");
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
      console.log("found.");
    } else {
      x.value = "Geolocation is not supported by this browser.";
    }
    function showPosition(position) {
      // x.innerHTML = "Latitude: " + position.coords.latitude +
      // "<br>Longitude: " + position.coords.longitude;
      latt = position.coords.latitude;
      long = position.coords.longitude;


      document.getElementById("living_long").value = long;
      document.getElementById("living_lat").value = latt;

      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_lat").value);
      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_long").value);
      $('#home_map').locationpicker({
        location: {
          latitude: latt,
          longitude: long
        }
      });
      document.getElementById("myButton1").value="موقعیت من";
    }
  }


  function getLocation_work()
  {
    document.getElementById("myButton2").value="در حال تشخیص ...";
    var x = document.getElementById("geolocation_status");
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
      console.log("found.");
    } else {
      x.value = "Geolocation is not supported by this browser.";
    }
    function showPosition(position) {
      // x.innerHTML = "Latitude: " + position.coords.latitude +
      // "<br>Longitude: " + position.coords.longitude;
      latt = position.coords.latitude;
      long = position.coords.longitude;
      document.getElementById("work_long").value = long;
      document.getElementById("work_lat").value = latt;



      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_lat").value);
      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_long").value);
      $('#work_map').locationpicker({
        location: {
          latitude: latt,
          longitude: long
        }
      });
      document.getElementById("myButton2").value="موقعیت من";
    }
  }

</script>
