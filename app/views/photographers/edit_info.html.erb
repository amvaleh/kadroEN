<script src="//maps.google.com/maps/api/js?key=AIzaSyBqAlo6eTQeSbkOn3xYIjJ4e1zr4ewrSxU"></script>
<%= javascript_include_tag "locationpicker.jquery"  %>
<% @top_title = "استودیوی شما" %>
<%= render 'shared/studio_header' , title: "اطلاعات اولیه" %>
<style>
  input{
    margin: 0;
  }
    .input-group button{
      height: 60px;
    }
</style>
<section id="main">
  <div class="container">
    <div class="main">
      <div class="wrapper">
        <div class="row">
          <%= render 'shared/studio_top_navigation' %>
          <div class="row">
            <h3 class="text-center">
              ویرایش اطلاعات اولیه
            </h3>
          </div>
          <br>
          <br>
          <%= form_for :photographer, url: update_info_photographer_path, method: "post" , html: {class: "form form-group" , :id => "update_info"} do |f| %>
          <input type="text" id="geolocation_status" name="geolocation_status" style="display:none"  />
          <input type="text" id="living_lat" name="photographer[living_lat]" value="<%= @photographer.location.living_lat.to_s%>" style="display:none"  />
          <input type="text" id="living_long" name="photographer[living_long]" value="<%= @photographer.location.living_long.to_s%>" style="display:none" />
          <input type="text" id="work_lat" name="photographer[working_lat]" value="<%= @photographer.location.working_lat.to_s%>" style="display:none"  />
          <input type="text" id="work_long" name="photographer[working_long]" value="<%= @photographer.location.working_long.to_s%>" style="display:none" />

          <div class="col-md-12 col-md-offset-0">
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  نام
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control mytextbox" type="text" name="photographer[first_name]" id="first_name" value="<%= @photographer.first_name%>" required="">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  نام خانوادگی
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control mytextbox" type="text" id="last_name" name="photographer[last_name]"  value="<%= @photographer.last_name%>" required="">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  ایمیل
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <input class="form-control" type="text" id="email" name="photographer[email]"  value="<%= @photographer.email %>" required="" disabled>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  شماره موبایل
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control" type="number" id="mobile_number" value="<%= @photographer.mobile_number %>" required="" data-parsley-pattern="(0|\+98)?([ ]|,|-|[()]){0,2}9[0|1|2|3|4]([ ]|,|-|[()]){0,2}(?:[0-9]([ ]|,|-|[()]){0,2}){8}" disabled>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  آیدی صفحه اختصاصی
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control mytextbox" type="text" id="uid" value="<%= @photographer.uid%>" required="" disabled>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  تلفن ثابت
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control" type="number" name="photographer[static_number]" id="static_number" value="<%= @photographer.static_number%>" required="">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-md-offset-0">
                <p>
                  تاریخ تولد:
                </p>
              </div>
              <div class="row" style="margin-bottom: 30px;">
                <div class="col-md-8 col-md-offset-0">
                  <!-- trying to run parsley on form submition -->
                  <input class="form-control" type="datetime" name="photographer[birthday]" id="date" value="<%= @photographer.birthday.to_date.to_pdate.to_s.tr('-0123456789','/۰۱۲۳۴۵۶۷۸۹') if @photographer.birthday.present? %>">

                </div>
              </div>
            </div>
          </div>
          <div class="col-md-12 col-md-offset-0">

             <div class="row">
              <div class="col-sm-12">
                <label for="work_map">
                  محل کار شما:
                  <p style="color: #b2bcc7; font-size: 0.9em;">
                    پروژه ها بر اساس موقیتی که برای محل کارتان اعلام می کنید به شما پیشنهاد می شود.
                  </p>
              </label>
              <div id="work_map" value=" " style="width: 100%; height: 400px;"></div>

              <div class="text-left">
                <input type="button" value="موقعیت من" id="myButton2" onclick="getLocation_work()" class="btn btn-xs btn-gray text-primary"></input>
              </div>
              <br>
              <input  type="text" name="photographer[working_input]" class="form-control" id="working_input"
              placeholder="آدرس محل کار شما" value="<%= @photographer.location.living_input%>" required>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div><!-- /.main -->
</div><!-- /.container -->
</section>

<footer id="footer">
  <div class="container">
    <div class="wrap">
      <%= link_to edit_photographer_registration_path , class: "btn btn-danger" do %>
      تغییر رمز عبور
      <i class="fa fa-lock"></i>
      <% end %>
      <button type="submit" id ="submit_page_form" class="btn btn-blue btn-lg">
      ثبت و ذخیره
      </button>
    </div>
  </div>
</footer>


<script type="text/javascript">
  $("#date").pDatepicker(
  {
    observer: true,

    format: 'YYYY/MM/DD',

    autoClose: true,
    initialValue: false,

  }

  );
</script>

<script>
  $(document).ready(function () {

    $(function () {
      $('[data-toggle="why_static_number"]').tooltip({
        title: "کادرو برای احراز هویت عکاسان با شماره ثابتی که می دهند تماس می گیرد و مصاحبه تلفنی کوتاهی از این طریق انجام می دهد."
      });
      $('[data-toggle="why_mobile_number"]').tooltip({
        title: "کادرو پروژه های جدید عکاسی را از طریق پیامک به شما اطلاع می دهد و یا در صورت وجود مشکل یا تغییری در برنامه به شما زنگ می زند."
      });

    })

    $('#submit_page_form').click(function(){
      if (document.getElementById("date").value != "") {
        document.getElementById("update_info").submit();
      } else {
        alert("لطفا تاریخ تولدتان را وارد کنید");
      }
    })

    // handel input phone_number and email for show other input
    $('#mobile_number, #email').on('change paste keyup', function () {
      var len1 = $('#mobile_number').val().length;
      var len2 = $('#email').val().length;
      if (len1 > 2 && len2 > 2) {
        $('#ask').removeClass('hidden');
      }
    });

    $('#update_info').parsley().on('field:validated', function () {
      $('button').prop('disabled', false);
    }).on('form:submit', function () {
    });
    var mapStyle = [
    {
      "featureType": "water",
      "stylers": [
      {
        "saturation": 43
      },
      {
        "lightness": -11
      },
      {
        "hue": "#0088ff"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "hue": "#ff0000"
      },
      {
        "saturation": -100
      },
      {
        "lightness": 99
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry.stroke",
      "stylers": [
      {
        "color": "#808080"
      },
      {
        "lightness": 54
      }
      ]
    },
    {
      "featureType": "landscape.man_made",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "color": "#ece2d9"
      }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "color": "#ccdca1"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.fill",
      "stylers": [
      {
        "color": "#767676"
      }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.stroke",
      "stylers": [
      {
        "color": "#ffffff"
      }
      ]
    },
    {
      "featureType": "poi",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    },
    {
      "featureType": "landscape.natural",
      "elementType": "geometry.fill",
      "stylers": [
      {
        "visibility": "on"
      },
      {
        "color": "#EBE5E0"
      }
      ]
    },
    {
      "featureType": "poi.park",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    },
    {
      "featureType": "poi.sports_complex",
      "stylers": [
      {
        "visibility": "on"
      }
      ]
    }
    ]

    var latitude = 35.7745054;
    var longitude = 51.3967018;
    $('#home_map').locationpicker({
      location: {
        latitude: <%=@photographer.location.living_lat %>,
        longitude: <%=@photographer.location.living_long %>
      },
      radius: 10,
      zoom: 13,
      inputBinding: {
        longitudeInput: $('#living_long'),
        latitudeInput: $('#living_lat'),
        locationNameInput: $('#living_input')
      },
      // markerInCenter: true,
      enableAutocomplete: true,
      autocompleteOptions: {
        types: ['geocode'],
        componentRestrictions: {country: 'ir'}
      },
      onchanged: function (currentLocation, radius, isMarkerDropped) {
      },
      styles: mapStyle
    });

    $('#work_map').locationpicker({
      location: {
        latitude: <%=@photographer.location.working_lat %>,
        longitude: <%=@photographer.location.working_long %>
      },
      radius: 10,
      zoom: 13,
      inputBinding: {
        longitudeInput: $('#work_long'),
        latitudeInput: $('#work_lat'),
        locationNameInput: $('#working_input')
      },
      // markerInCenter: true,
      enableAutocomplete: true,
      autocompleteOptions: {
        types: ['geocode'],
        componentRestrictions: {country: 'ir'}
      },
      onchanged: function (currentLocation, radius, isMarkerDropped) {
        // alert("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");
      },
      styles: mapStyle
    });
  });


  function getLocation_home()
  {
    document.getElementById("myButton1").value="در حال تشخیص ...";
    var x = document.getElementById("geolocation_status");
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
      console.log("found.");
    } else {
      x.value = "Geolocation is not supported by this browser.";
    }
    function showPosition(position) {
      // x.innerHTML = "Latitude: " + position.coords.latitude +
      // "<br>Longitude: " + position.coords.longitude;
      latt = position.coords.latitude;
      long = position.coords.longitude;


      document.getElementById("living_long").value = long;
      document.getElementById("living_lat").value = latt;

      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_lat").value);
      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_long").value);
      $('#home_map').locationpicker({
        location: {
          latitude: latt,
          longitude: long
        }
      });
      document.getElementById("myButton1").value="موقعیت من";
    }
  }

  function getLocation_work()
  {
    document.getElementById("myButton2").value="در حال تشخیص ...";
    var x = document.getElementById("geolocation_status");
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
      console.log("found.");
    } else {
      x.value = "Geolocation is not supported by this browser.";
    }
    function showPosition(position) {
      // x.innerHTML = "Latitude: " + position.coords.latitude +
      // "<br>Longitude: " + position.coords.longitude;
      latt = position.coords.latitude;
      long = position.coords.longitude;
      document.getElementById("work_long").value = long;
      document.getElementById("work_lat").value = latt;



      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_lat").value);
      console.log(document.getElementById("work_long").value);
      console.log(document.getElementById("work_long").value);
      $('#work_map').locationpicker({
        location: {
          latitude: latt,
          longitude: long
        }
      });
      document.getElementById("myButton2").value="موقعیت من";
    }
  }

</script>
<script>
  $(".mytextbox").on("keypress", function(event) {

    // Disallow anything not matching the regex pattern (A to Z uppercase, a to z lowercase and white space)
    // For more on JavaScript Regular Expressions, look here: https://developer.mozilla.org/en-US/docs/JavaScript/Guide/Regular_Expressions
    var englishAlphabetAndWhiteSpace = /[A-Za-z ]/g;

    // Retrieving the key from the char code passed in event.which
    // For more info on even.which, look here: http://stackoverflow.com/q/3050984/114029
    var key = String.fromCharCode(event.which);

    //alert(event.keyCode);

    // For the keyCodes, look here: http://stackoverflow.com/a/3781360/114029
    // keyCode == 8  is backspace
    // keyCode == 37 is left arrow
    // keyCode == 39 is right arrow
    // englishAlphabetAndWhiteSpace.test(key) does the matching, that is, test the key just typed against the regex pattern
    if (event.keyCode == 32) {
      return true;
    }
    if (event.keyCode == 8 || event.keyCode == 37 || event.keyCode == 39 || englishAlphabetAndWhiteSpace.test(key)) {
      alert("لطفا فارسی تایپ کنید");
      return false;
    }

    // If we got this far, just return false because a disallowed key was typed.
    return true;
  });

  $('#mytextbox').on("paste",function(e)
  {
    e.preventDefault();
  });

</script>
<!-- <script type="text/javascript" src='https://maps.google.com/maps/api/js?key=AIzaSyBqAlo6eTQeSbkOn3xYIjJ4e1zr4ewrSxU&sensor=false&libraries=places'></script> -->
